<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Dela+Gothic+One">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Assistant">
	<title>Radio Rumble</title>
	<link href="https://vjs.zencdn.net/8.5.2/video-js.css" rel="stylesheet" />
	<link rel="alternate" type="application/feed+json" title="JSON Feed for Radio Rumble" href="https://radio.rumble.nyc/feed.json" />
	<link rel="alternate" type="application/rss+xml" title="RSS/XML Feed for Radio Rumble" href="https://radio.rumble.nyc/feed.xml" />
	
	<link rel="stylesheet" href="/css/podcast.css">
	 <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.12.3/cdn.min.js" defer></script>
</head>
<body>
	<div id="main">
		<h2 id="live"></h2>
		<div id="livePlayerContainer" style="display:none">
			<audio controls id="live-stream">
				<source src="https://icecast.smartdata.link/stream" type="audio/mpeg" />
			</audio>
		</div>


		<div class="container" x-data="podcastApp()">
			<div x-show="loading" class="loading">
			  <div class="loading-spinner"></div>
			  Loading feed...
			</div>
			
			<template x-if="!loading && feed">
			  <div>
				<div class="playlist-header">
				  <h1 class="playlist-title" x-text="feed.title"></h1>
				  <div x-text="`${feed.items.length} episodes`"></div>
				</div>
				
				<div class="track-list">
				  <template x-for="(episode, index) in feed.items" :key="episode.id">
					<div 
					  class="track" 
					  :class="{ 'active': currentEpisodeIndex === index }"
					  @click="playTrack(index)"
					>
					  <div class="track-image-container">
						<img class="track-image" :src="episode.image" alt="Episode cover">
						<div class="track-image-overlay">
						  <button class="play-button" @click.stop="togglePlayPause(index)">
							<template x-if="isPlaying && currentEpisodeIndex === index">
							  <span>⏸&#xFE0E;</span>
							</template>
							<template x-if="!isPlaying || currentEpisodeIndex !== index">
							  <span>▶</span>
							</template>
						  </button>
						</div>
					  </div>
					  <div class="track-info">
						<div class="track-name" x-text="episode.title"></div>
					  </div>
					</div>
				  </template>
				</div>
				
				<template x-if="currentEpisode">
				  <div class="now-playing">
					<img class="now-playing-image" :src="currentEpisode.image" alt="Episode cover">
					<div class="now-playing-info">
					  <div class="now-playing-title" x-text="currentEpisode.title"></div>
					 
					  
					  <div class="progress-container" @click="seek($event)">
						<div class="progress-bar" :style="`width: ${progress}%`"></div>
					  </div>
					  
					  <div class="time-info">
						<div x-text="formatTime(currentTime)"></div>
						<div x-text="formatTime(duration)"></div>
					  </div>
					</div>
				  </div>
				</template>
				
				<template x-if="currentEpisode">
				  <div class="player-controls">
					<button class="player-control-button" @click="previousTrack()">⏮&#xFE0E;</button>
					<button class="player-control-button play-pause" @click="togglePlayPause()">
					  <template x-if="isPlaying">
						<span>⏸&#xFE0E;</span>
					  </template>
					  <template x-if="!isPlaying">
						<span>▶</span>
					  </template>
					</button>
					<button class="player-control-button" @click="nextTrack()">⏭&#xFE0E;</button>
				  </div>
				</template>
			  </div>
			</template>
			
			<template x-if="!loading && error">
			  <div>
				<h2>Error loading playlist</h2>
				<p x-text="error"></p>
			  </div>
			</template>
		  </div>
		  
		  <script src="/js/podcastApp.js?v=0.0.1"></script>

	
</div>
	</div>
	 <script src="https://vjs.zencdn.net/8.5.2/video.min.js"></script>
	 <script>
		var audio = document.querySelector('#live-stream');
		var player = document.querySelector('#livePlayerContainer');
		audio.addEventListener('canplay', function(evt) {
			console.log('canplay', evt);
			// document.querySelector('#live').innerText = 'Live!';
		});
		audio.addEventListener('error', function(evt) {
			console.error('error', evt);
			// document.querySelector('#live').innerText = 'Offline';
		});

		async function init(){
			const response = await fetch('https://icecast.smartdata.link/status-json.xsl');
			const data = await response.json();
			console.log(data.icestats);
			if(data.icestats.source){
				document.querySelector('#live').innerText = 'Live!';
				player.style.display = 'block';
			} else {
				console.log('no live stream');
				document.querySelector('#live').innerText = '';
				// audio.setAttribute('style',  'display:none');
				// hide the audio element
				player.style.display = 'none';

			}
		}
		init();
		</script>
</body>
</html>
